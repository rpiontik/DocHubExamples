# Начало работы над архитектурой

Чтобы каким то образом, хотя бы начать работать с архитектурой, и шире с архитектурными решениями требуется выполнить ряд шагов "в собственной голове", а также в инструментарии архитектора, и основная проблема - это **как начать**

Если вы придете к архитекторам или шире "к лицам принимающим архитектурные решения" - они вам будут рассказывать абстрактные истории про "TOGAF, Archimate и о том что существуют магические Enterprise архитекторы, которые...". Но для того чтобы начать - вам важно понимать другое:

* нужно создать файлики исходного кода
* нужно собрать файлики исходного кода
* нужно задеплоить файлики исходного кода 
* вы получите "продукт-архитектура редакции 0.1.0"

## Настройка инструментария и содание репозитория

Для начала нужно настроить окружение разработчика. Правильные пацаны и девчонки любят следующие консольные утилиты

* **git** - это консольная утилита для работы с исходным кодом
* **make** - это консольная утилита для выполнения задач создания чего-либо из исходников

> Примечание: для Windows рабочей станции крайне рекомендуется использовать WSL2 и соответственно тогда установка данных утилит у вас займет минимум времени (на примере Debian - это будет выглядеть вот так `apt install git make`)

Опять же правильные пацаны и девчонки любят следующие IDE

* VSCodium  c тремя расширениями
    * dochub https://t.me/c/1750057593/378
    * markdown

**Шаг -1 (минус один)** - нужно сделать себе GIT репозиторий и открыть его в интегрированной среде разработки (IDE вы же помните как расшифровывается)

> Если лично вы любите продукты JetBrains в качестве IDE - вы конечно же помните что "оно слишком много скрывает", поэтому можете использовать их продукты - но в инструкцию их установку добавлять не хочется, потому что они нам не платят за их рекламу ;-), как и Microsoft за рекламу VSCPOde

## Подготовка глоссария

Архитекторы выбирают точку отсчета - что болит больше всего... Обычно предлагается взять "систему" как основу. Причем в выборе системы вы скорее всего ошибетесь... Потому что это и не система окажется.

**Шаг 0:** Формиование требования - зачем вам архитектура как код. Самому себе.

Как вы помните - кодирование у нас начинается с требования, и первым требованием которое мы советуем вам закодировать - это **Что за хренью вы занимаетесь, что вы сейчас рарабатываете и для кого**

## Структура каталог архитектурного репозитория

**Шаг 1:** Поэтому начинать нужно с файлика - первого файлика "Введение" - точнее главных настроек - пусть будет файлик [dochub.yaml](./src/dochub.yaml) - так что создайте файлик если он не создан. Еще нам понадябтся внутри репозитория еще 3 файлика, а всего их будет 4-ре (четыре). 

* [./src/README.md](./src/README.md)
* [./src/root.yaml](./src/root.yaml)
* [./src/docs/root.yaml](./src/docs/root.yaml)

## Ваш первый коммит в архитектуру

Чтобы сделать первый коммит и как следствие первый релиз - вам нужно получить первое графическое представление контекста для которого вы строите архитектуру (архитектура такая прикольная штука - что слово "контекст" это абстрактная хрень, которую вы можете интерпретировать как хотите)

По сути вы должны определить контекст в котором вы работает - для этого вам понадобитя определить "Аспект" (аспект - слово непонятное, неудобное и слишком обстрактное, поэтому действуйте от "ожидаемой схемы")
Чтобы понять - аспекты и другие непонятные слова, вам лучше начать с компонентов которые вы хотите отобразить на схеме

**Шаг 2:** 

Создадим компоненты, которые у нас буду участвовать на схемке и ипортируем его внутрь файлика с введением
Пусть их будет 4 классических для MVC приложения

* сама система с ее бизнес названием `enterprise.system.accounting`
* ее клиентская часть `enterprise.system.accounting.standaloneclient`
* ее серверный контейнер ``enterprise.system.accounting.backendlogic`
* ее хранилище данных ``enterprise.system.accounting.database` 

что будет выглятеть в виде **YAML** c нужными нам реквизитами

```
components:
  enterprise.systems.accounting: 
    title: Бухгалтерия предприятия
  enterprise.systems.accounting.standaloneclient:
    title: Клиентское окно сотрудника бухгалтерии
  enterprise.systems.accounting.backendlogic:
    title: Серверная логика системы бухгалтерского учета
  enterprise.systems.accounting.database:
    title: Хранилище данных (СУБД) бухгалтерского учета  

```

**Ключевое момент на этом шаге - это придумать идентификаторы ваших компонентов. Здесь вам понадобится мозг**

сделайте главное упражнение `git add * && git commit -m "добавлены компоненты учетной системы"`

## Уже деплой (правда локальный)

**Шаг 3** Теперь как и в случае с разработкой нам необходимо проверить локальное развертывание нашей архитектуры. Для этого нам понадобится Docker

```
docker run --rm -p 38080:8080 -v ./src:/usr/share/nginx/html/documentation ghcr.io/rabotaru/dochub:v2.6.2
```

Раз вы разрабатывает архитектуру - то нужно же автоматически тестировать и тестировать нужно в том числе на развертываемость. Тут есть несколько особенностей:

* сам DocHub при локальном подключении ожидает адрес манифеста [./src/dochub.yaml](./src/dochub.yaml) относительно каталога nginx, потому что он собственно собран на базе Nginx
* сам DocHub при локальном подключении пытается "построить архитектуру самого себя" и это нужно отключать - зачем вам его архитектура - вы же свою строите

И тут вас интересуют первые непройденные тесты - http://localhost:8080/problems, и здесь вы обнаружите еще одно непонятное слово "Метамодель", это в довесок к "Контекстам и Аспектам"... И тут надо привыкать к архитектурным абстракциям. Дело в том что виденье по архитектуре - состоит из "сущностей" на каждой из слоев". И вот типы этих сущностей и способы их отображения - это и есть метамодель. Занимаясь моделированием метаданных архитектуры - вы и создаете свою архитектуру... Но... Это слишком абстрактно, поэтому нас интересует 2 вида проблем

* `компоненты вне контекста`
* `компоненты без корневого компонента`

## Чиним первые упавшие тесты-проблемы

**Шаг 4**: Теперь бы нам поправить, проблемы - и по сути "компоненты без корневого компоненты" тонко вам указывают на связи внешнего окружения - компоненты же не живут в вакууме... И чинить это просто, например так

```
components:
  enterprise: # Корневой компонент (домен)
    title: Холдинг "Замечательный"
  enterprise.systems:
    title: Системы учета хозяйственных операций
  enterprise.systems.accounting: 
    title: Бухгалтерия предприятия
  enterprise.systems.accounting.standaloneclient:
    title: Клиентское окно сотрудника бухгалтерии
  enterprise.systems.accounting.backendlogic:
    title: Серверная логика системы бухгалтерского учета
  enterprise.systems.accounting.database:
    title: Хранилище данных (СУБД) бухгалтерского учета  

```

* Мы добавили 2 верхнеуровневых компоненты - само предприятие, и класс систем... Нам сейчас так захотелось и это хорошо... Если мы ошиблись - мы поправим это потом

А вот с контекстом интересней, потому что это то как вы хотите посмотреть/показать другим свою архитектуру. Сейчас сделаем самое простое упражнение - нам теперь надо отобразить "Все наши учетные системы"

создадим файл [./src/contexts/root.yaml](./src/contexts/root.yaml) и добавим в него магию представления

```
contexts:
  arch.all.systems:
    title: Все наши системы 
    location: Верхнеуровневый прикладной ландшафт/Холдинг Замечательный
    components:
      - enterprise.systems.*
```

Теперь у нас есть архитектура http://localhost:8080/architect/components/enterprise (не забудьте снова сделать деплой и коммит)

## Из чего эта хрень состоит

Это круто что у нас есть архитектура, но нам нужно явно указать какие у нас там технологии. И это товарищи ваш первый внутренний "холивар" - как их категоризировать, НО - раз мы кодируем то давайте создадим файлик

**Шаг 4**:

* [./src/techstack/root.yaml](./src/techstack/root.yaml)

## Аспектно, контекстно, документно ориентирование программирование

Мы с вами уже заимели - контекст отображения, компоненты и технологии, осталось добавить документацию и аспекты (чтобы это не значило).
Начнем с самого тяжелого - **"аспект"** - 

**Шаг 5**:

## Собираем и деплоим

** закажите себе доменное имя для вашего хаба - например https://arc42hub.sec.example.com и ресурсы для развертывания Docker не более 2 CPU/2Gb RAM - этого будет достаточно и попросите людей с ценностями DevOps (или сами) развернуть вам там DocHub

**Шаг 6**:

## Что дальше

* определите для себя и для своей команды цель которую вы хотите достичь инструментом - цель краткосрочная: например описать ИТ ландшафт, **чтобы он был понятен даже младшему инженеру** - не замахивайтесь на глобальное, запутаетесь в стратегии.
* рисуйте на совещаниях и обсуждения "скетчи архитектуры" в Draw.IO и Miro - они могут стать основой для вашей структуры
* коммитьТе чаще и делайте деплой "раз в сутки", рассылайте ссылку на ваш портал ArcHub имеющим право "подумать над архитектурой".
* коммитьТе даже во время совещаний - не забывайте что есть **feature-branch**
* читайте "документацию по самому Dochub и вступайте в группу чудесных архитекторов и задавайте "вопрос"
* если у вас есть знания по vue.js, node 16+ и git+docker - попробуйте поконтрибьютить в сам проект ;-) 
* PROFFIT - выпускайте релизы архитектуры
